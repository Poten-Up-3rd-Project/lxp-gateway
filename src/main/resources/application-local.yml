server:
  port: 8089

spring:
  application:
    name: gateway-service
  autoconfigure:
    exclude:
      - org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration
      - org.springframework.boot.autoconfigure.orm.jpa.HibernateJpaAutoConfiguration
      - org.springframework.boot.autoconfigure.jdbc.DataSourceTransactionManagerAutoConfiguration
    jpa:
      enabled: false
  data:
    redis:
      host: localhost
      port: 6379
  cloud:
    gateway:
      server:
        webflux:
          routes:
            # ==========================================
            # 1. Auth Service
            # ==========================================
            - id: auth-register
              uri: http://app-auth:8082
              predicates:
                - Path=/api-v1/auth/register
                - Method=POST

            - id: auth-login
              uri: http://app-auth:8082
              predicates:
                - Path=/api-v1/auth/login
                - Method=POST

            - id: auth-logout
              uri: http://app-auth:8082
              predicates:
                - Path=/api-v1/auth/logout
                - Method=POST
              filters:
                - JwtAuthentication

            # ==========================================
            # 2. User Service
            # ==========================================
            - id: user-info
              uri: http://app-user:8081
              predicates:
                - Path=/api-v1/users
                - Method=GET
              filters:
                - JwtAuthentication

            - id: user-update
              uri: http://app-user:8081
              predicates:
                - Path=/api-v1/users
                - Method=PATCH
              filters:
                - JwtAuthentication

            - id: user-role-update
              uri: http://app-user:8081
              predicates:
                - Path=/api-v1/users/role
                - Method=PUT
              filters:
                - JwtAuthentication

            - id: user-withdraw
              uri: http://app-user:8081
              predicates:
                - Path=/api-v1/users
                - Method=DELETE
              filters:
                - JwtAuthentication

            # ==========================================
            # 3. Course Service
            # ==========================================

            # ==========================================
            # 4. Enrollment Service
            # ==========================================

            # ==========================================
            # 5. Recommend Service
            # ==========================================

resilience4j:
  circuitbreaker:
    instances:
      redis:
        failure-rate-threshold: 50  # 실패율 50% 이상이면 Open
        wait-duration-in-open-state: 10s  # Open 상태 10초 유지
        sliding-window-size: 10  # 최근 10개 요청 기준
        minimum-number-of-calls: 5  # 최소 5번 호출 후 판단

jwt:
  private-key-string: ${JWT_KEY_PRIVATE:defaultPrivateKeyBase64}
  public-key-string: ${JWT_KEY_PUBLIC:defaultPublicKeyBase64}

passport:
  key:
    secret-key: ${PASSPORT_KEY_SECRET:default-secret-key-for-testing-minimum-32chars}
    duration-millis: ${PASSPORT_DURATION_MILLI:3600000}

logging:
  level:
    org.springframework.cloud.gateway: DEBUG
    org.springframework.cloud.gateway.route.RouteDefinitionRouteLocator: DEBUG
    org.springframework.cloud.gateway.handler.RoutePredicateHandlerMapping: TRACE
    reactor.netty.http.server: DEBUG
    com.lxp.gateway.global: DEBUG
